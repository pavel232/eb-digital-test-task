# Реализация экранов онбординга с видео

## Задание

```
Тестовое задание
Три однотипных экрана онбординга, состоящих из
Видео плеера на весь экран
Текста
Кнопки “Далее”
Экраны можно свайпать влево/вправо либо переходить на следующий (вправо) по нажатию на кнопку “Далее”
Три видео для каждого экрана
https://limewire.com/d/hhEvc#nkoQ6jSxy8
хранятся локально
имеют звуковую дорожку
При переключении между экранами видео на уходящем экране нужно ставить на паузу и начинать проигрывать видео показывающегося экрана.
Видео должно проигрваться бесконечно без остановки
Экран телефона не должен гаснуть
Память не должна течь
Не обязательно: запоминать, на каком моменте закончилось проигрывание и продолжать с него при возвращении на соответствующий экран.
```

## Обзор
Это iOS-приложение реализует три экрана онбординга с функционалом воспроизведения видео. Реализация использует SwiftUI и AVKit для работы с видео.
```
SwiftUI
AVKit
Swift 6
iOS target 18
```

## Функциональность

### Реализация основных требований
- ✅ Три экрана онбординга с полноэкранными видео-плеерами
- ✅ Отображение текста для каждого экрана
- ✅ Кнопка "Далее" для навигации
- ✅ Навигация свайпами (влево/вправо) с использованием TabView
- ✅ Локальное хранение видео
- ✅ Поддержка аудио в видео
- ✅ Корректная обработка паузы/воспроизведения при переключении экранов
- ✅ Бесконечное воспроизведение видео
- ✅ Предотвращение затемнения экрана
- ✅ Управление памятью (отсутствие утечек)
- ✅ Сохранение позиции воспроизведения

### Архитектура
Приложение следует паттерну MVVM и состоит из следующих компонентов:

#### Координатор
- `AppCoordinator`: Создает экраны и управляет навигацией (В данном примере только один экран и навигации как таковой нет, но такое решение более расгиряемо для возможных дополнительных экранов в будущем)

#### Экраны
- `VideosScreenView`: Основной view, содержащий экраны онбординга
- `VideosScreenViewModel`: Управляет состоянием `VideosScreenView`

#### UI Компоненты
- `VideoPlayerView`: Компонент видео-плеера
- `ErrorAlert`: Компонент обработки ошибок

#### Сервисы
- `LoadDataService`: Обрабатывает загрузку данных видео

## Технические детали реализации

### Воспроизведение видео
- Использует `AVPlayer` для воспроизведения видео
- Реализует бесконечный цикл с помощью наблюдателя уведомлений `AVPlayerItemDidPlayToEndTime`
- Управляет состоянием видео при переключении экранов
- Поддерживает две стратегии загрузки видео:
  1. Текущая: Все видео загружаются сразу (по умолчанию)
  2. Альтернативная: Постраничная загрузка с сохранением позиции

### Навигация
- Реализует навигацию свайпами и кнопкой
- Использует `TabView` с `PageTabViewStyle` для функционала свайпов
- Поддерживает корректное состояние видео при навигации
- `TabView` автоматически сохраняет позицию видео в текущей реализации

### Управление памятью
- Корректная очистка в `deinit`
- Использует фреймворк Combine для управления подписками
- Реализует правильную очистку ресурсов
- Поддерживает опциональную постраничную загрузку видео для уменьшения использования памяти

## Оценка выполнения требований

| Требование | Статус | Примечания |
|------------|--------|------------|
| Три экрана онбординга | ✅ | Реализовано с использованием TabView |
| Полноэкранный видео-плеер | ✅ | Использует AVPlayer |
| Отображение текста | ✅ | Реализовано в VideoPlayerView |
| Кнопка "Далее" | ✅ | Реализована с корректной навигацией |
| Навигация свайпами | ✅ | Использует TabView с PageTabViewStyle |
| Локальное хранение видео | ✅ | Видео загружаются из локальных ресурсов |
| Поддержка аудио | ✅ | Использует AVPlayer с поддержкой аудио |
| Обработка паузы/воспроизведения | ✅ | Корректное управление состоянием при переходах |
| Бесконечный цикл видео | ✅ | Реализовано с помощью наблюдателя уведомлений |
| Предотвращение затемнения | ✅ | Экран остается активным при воспроизведении |
| Предотвращение утечек памяти | ✅ | Корректное управление ресурсами |
| Сохранение позиции видео | ✅ | Реализовано двумя способами: 1) Через TabView (текущий), 2) Через собственное отслеживание позиции (альтернативный) |

## Сохранение позиции видео
В приложении реализовано сохранение позиции видео двумя способами:

1. **Текущая реализация (по умолчанию)**
   - Использует встроенное сохранение состояния TabView
   - Все видео загружаются сразу
   - Позиция автоматически сохраняется при навигации

2. **Альтернативная реализация (опционально)**
   - Постраничная загрузка видео
   - Собственное отслеживание позиции через функции `loadPlayer` и `unloadPlayer`
   - Более эффективное использование памяти, но требует дополнительной настройки
   - Может быть включена путем раскомментирования соответствующего кода в `VideoPlayerView` и `VideosScreenViewModel`

## Использование
1. Запустите приложение
2. Используйте свайпы влево/вправо или кнопку "Далее" для навигации между экранами
3. Видео будут автоматически воспроизводиться и зацикливаться
4. Экран останется активным во время воспроизведения видео
5. Позиция видео сохраняется при навигации между экранами

## Технические примечания
- Реализация использует современные возможности SwiftUI
- Реализована корректная обработка ошибок
- Управление памятью осуществляется через правильную очистку и управление ресурсами
- Код структурирован для поддержки и масштабирования
- Поддерживает как немедленную, так и отложенную загрузку видео-ресурсов
